# 总成绩导入功能说明

## 功能概述

已更新导入工具以支持总成绩（总分）的导入。

## 重要说明

**总分科目固定使用SubjectId=10**

- 在Subjects表中，总分科目的SubjectId固定为10
- 在Scores表中，SubjectId=10的记录表示总分成绩
- 导入工具会自动检查并创建/修正SubjectId=10的科目

## 支持的总分列名

### 成绩列
- 总分分数
- 总分
- 总成绩

### 班级排名列
- 总分班名次
- 总分班级名次
- 总分班级排名

### 年级/学校排名列
- 总分校名次
- 总分年级名次
- 总分年级排名

## 使用步骤

### 1. 检查并创建总分科目（SubjectId=10）

运行 `检查总分科目.bat`，该脚本会：
- 检查SubjectId=10是否存在
- 如果不存在，自动创建SubjectId=10、SubjectName='总分'的科目
- 如果SubjectId=10存在但名称不是'总分'，提示是否更新

### 2. 导入成绩

使用以下任一导入工具：
- `导入Excel成绩Python版.bat`
- `导入Excel成绩V2版.bat`
- `快速导入成绩.bat`

导入工具会自动识别并处理总分相关的列。

## 数据库结构

总分数据会和其他科目一样，存储在Scores表中，**SubjectId=10**表示总分。

### Subjects表结构示例

| SubjectId | SubjectName | SubjectCode |
|-----------|--------------|--------------|
| 1 | 语文 | CHINESE |
| 2 | 数学 | MATH |
| ... | ... | ... |
| 10 | 总分 | TOTAL |

### Scores表结构示例

| ScoreId | ExamId | StudentId | SubjectId | Score | ClassRank | GradeRank |
|---------|---------|------------|------------|--------|-----------|------------|
| 1 | 1 | 101 | 1 | 120 | 5 | 20 |
| 2 | 1 | 101 | 10 | 580 | 3 | 15 |

其中SubjectId=10的记录表示总分。

## 示例

假设Excel中有以下列：
| 姓名 | 学号 | 语文 | 语文班名次 | 语文年级名次 | 总分 | 总分班名次 | 总分校名次 |
|------|------|------|------------|------------|------|-----------|-----------|
| 张三 | 001 | 120 | 5 | 20 | 580 | 3 | 15 |

导入后：
- 张三的语文成绩：120分，班级排名5，年级排名20，SubjectId=1
- 张三的总分成绩：580分，班级排名3，年级排名15，**SubjectId=10**

## 注意事项

1. **SubjectId=10固定为总分**：数据库设计中，SubjectId=10固定表示总分科目
2. **总分科目自动创建/修正**：如果数据库中不存在SubjectId=10，导入工具会自动创建
3. **排名字段匹配**：支持多种排名列名格式（班名次/班级名次/班级排名等）
4. **数据类型处理**：自动处理排名的float类型（如1.0、2.0等）

## 字段映射规则

### 成绩列映射
```python
'总分分数' == header
or '总分' == header
or '总成绩' in header
→ col_map['总分_score']
```

### 班级排名映射
```python
'总分班名次' in header
or '总分班级名次' in header
or '总分班级排名' in header
→ col_map['总分_class_rank']
```

### 年级排名映射
```python
'总分校名次' in header
or '总分年级名次' in header
or '总分年级排名' in header
→ col_map['总分_grade_rank']
```

## 科目映射表

```python
SUBJECT_IDS = {
    '语文': 1,
    '数学': 2,
    '英语': 3,
    '物理': 4,
    '化学': 5,
    '生物': 6,
    '政治': 7,
    '历史': 8,
    '地理': 9,
    '总分': 10  # 固定使用SubjectId=10
}
```

## 更新日志

- **固定SubjectId=10为总分科目**
- 添加总分科目自动检测和创建功能
- 支持总分、总成绩、总分分数等多种列名
- 支持总分班名次、总分校名次等排名字段
