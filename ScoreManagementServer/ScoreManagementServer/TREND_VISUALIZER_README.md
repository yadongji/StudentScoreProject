# 成绩趋势可视化工具

## 🎯 功能介绍

这是一个用于查询和可视化学生成绩进步/退退情况的工具，支持：

- ✅ 按学号或姓名搜索学生
- ✅ 查看总分或单科成绩趋势
- ✅ 生成折线图（成绩和排名）
- ✅ 显示进步/退步标记
- ✅ 全部科目对比图

## 📦 安装依赖

```bash
pip install matplotlib numpy
```

## 🚀 使用方法

### 启动工具

```bash
cd e:\StudentScoreProject\ScoreManagementServer\ScoreManagementServer
python score_trend_visualizer.py
```

### 完整操作流程

#### 第一步：搜索学生

```
请输入学号或姓名（支持模糊搜索）: 张三

找到 2 个学生:
  1. 学号: 202407001, 姓名: 张三, 班级: 107班
  2. 学号: 202407045, 姓名: 张三二, 班级: 107班

请选择学生编号（1-2）: 1
```

#### 第二步：选择科目

```
============================================================
  张三 (202407001) 的考试科目
============================================================
  1. 语文 (3次考试)
  2. 数学 (3次考试)
  3. 英语 (3次考试)
  4. 物理 (3次考试)
  5. 化学 (3次考试)
  6. 生物 (3次考试)
  7. 总分 (3次考试)
  8. 全部科目对比

请选择科目（1-8）: 7
```

#### 第三步：选择显示内容

```
是否显示年级排名？（y/n，默认y）: y
```

#### 第四步：查看结果

**控制台输出：**

```
============================================================
📊 总分成绩趋势分析
============================================================
考试名称       考试日期     分数    校名次  变化      趋势
------------------------------------------------------------
2024年9月月考   2024-09-20   520.5   15      -         -
2024年10月月考  2024-10-15   545.0   12      +24.5     📈 ↑ 进步
2024年11月期中考 2024-11-10   538.5   13      -6.5      📉 ↓ 退步
============================================================
```

**折线图：**

![示例图](趋势图_张三_总分.png)

- 蓝色实线：成绩趋势
- 红色虚线：年级排名（可选，y轴反转）
- 📈 绿色标记：进步
- 📉 红色标记：退步
- ➡️ 灰色标记：持平

## 📊 图表说明

### 单科趋势图

**X轴：** 考试时间（日期）

**Y轴（左侧）：** 分数

**Y轴（右侧）：** 年级排名（反转，越小越好）

**数据标签：**
- 蓝色数字：分数值
- 红色数字：排名值
- 📈 / 📉 / ➡️：趋势标记

**示例：**

```
2024-09-20  2024-10-15  2024-11-10
   520.5       ↑+24.5      545.0      ↓-6.5      538.5
     📈                    📉
```

### 全部科目对比图

对比多个科目的成绩变化，帮助发现：

- 哪些科目进步明显
- 哪些科目需要加强
- 整体学习趋势

## 🔍 功能特性

### 1. 智能搜索

- 支持学号搜索：`202407001`
- 支持姓名搜索：`张三`
- 支持模糊搜索：`张`

### 2. 灵活选择

- 查询单科成绩（语文、数学、物理等）
- 查询总分趋势（SubjectId=10）
- 全部科目对比（一次性查看所有科目）

### 3. 可视化选项

- 显示/隐藏年级排名
- 自动保存图片
- 中文标签显示

### 4. 详细分析

- 分数变化值（+24.5, -6.5）
- 趋势标记（进步/退步/持平）
- 文字摘要和图表双重视角

## 📈 趋势分析示例

### 情况1：持续进步

```
考试1: 520.5 (#15)
考试2: 545.0 (#12)  ↑+24.5  📈
考试3: 570.5 (#8)   ↑+25.5  📈
```

**结论：** 学习状态良好，进步明显

### 情况2：波动退步

```
考试1: 570.5 (#8)
考试2: 545.0 (#12)  ↓-25.5  📉
考试3: 520.5 (#15)  ↓-24.5  📉
```

**结论：** 需要关注学习状态，查找原因

### 情况3：持平稳定

```
考试1: 545.0 (#10)
考试2: 547.5 (#10)  ↑+2.5   📈
考试3: 546.0 (#10)  ↓-1.5   📉
```

**结论：** 成绩稳定，波动较小

## 🎨 图表样式

### 颜色方案

| 元素 | 颜色 | 说明 |
|------|------|------|
| 成绩线 | #3498db（蓝色） | 主数据线 |
| 排名线 | #e74c3c（红色） | 次要数据线 |
| 进步标记 | 绿色 | ↑ 符号 |
| 退步标记 | 红色 | ↓ 符号 |
| 持平标记 | 灰色 | → 符号 |

### 全部科目对比颜色

使用不同的颜色区分各科目，方便对比。

## 💡 使用技巧

### 1. 快速查看总分

搜索学生后直接选择"总分"即可查看整体趋势。

### 2. 发现薄弱科目

选择"全部科目对比"，观察哪些科目线在下方，需要加强。

### 3. 评估进步幅度

查看摘要中的"变化"列，数字越大表示进步/退步越明显。

### 4. 排名对比

启用年级排名显示，可以看到成绩变化是否带来排名提升。

## 📁 输出文件

图表自动保存为PNG格式，文件名规则：

```
趋势图_学生姓名_科目.png
趋势图_学生姓名_全部科目.png
```

示例：
- `趋势图_张三_总分.png`
- `趋势图_张三_物理.png`
- `趋势图_张三_全部科目.png`

## ⚙️ 配置选项

### 修改数据库路径

```python
# 在 score_trend_visualizer.py 中修改
DB_PATH = '你的数据库路径.db'
```

### 修改中文字体

```python
# 如果中文显示乱码，尝试修改字体列表
plt.rcParams['font.sans-serif'] = ['你的字体名称']
```

## ❓ 常见问题

### Q: 中文显示为方框

**A:** 修改字体设置：
```python
plt.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei']
```

### Q: 图表不显示

**A:** 检查matplotlib是否正确安装：
```bash
python -c "import matplotlib; print(matplotlib.__version__)"
```

### Q: 找不到学生

**A:** 确认：
1. 数据库路径是否正确
2. 学生信息是否已导入
3. 搜索关键词是否正确

### Q: 提示"只有1次考试"

**A:** 趋势分析需要至少2次考试成绩，请先导入多次考试的数据。

## 🔄 与其他工具配合使用

### 1. 导入数据

```bash
# 导入学生信息
python excel_to_sqlite_v2.py
# 选择 1. 导入学生信息

# 导入成绩（多次考试）
python excel_to_sqlite_v2.py
# 选择 2. 导入学生成绩
```

### 2. 查询趋势

```bash
python score_trend_visualizer.py
```

### 3. 导出报告

图表保存后可以：
- 插入Word/Excel报告
- 打印给学生/家长
- 分享到班级群

## 📊 数据库查询示例

如果想自己写查询语句：

### 查询某学生总分趋势

```sql
SELECT
    e.ExamName,
    e.ExamDate,
    s.Score,
    s.GradeRank,
    LAG(s.Score, 1) OVER (ORDER BY e.ExamDate) as PrevScore,
    s.Score - LAG(s.Score, 1) OVER (ORDER BY e.ExamDate) as ScoreChange
FROM Scores s
JOIN Exams e ON s.ExamId = e.ExamId
WHERE s.StudentId = 1 AND s.SubjectId = 10
ORDER BY e.ExamDate;
```

### 查询某学生全部科目对比

```sql
SELECT
    e.ExamDate,
    sb.SubjectName,
    s.Score
FROM Scores s
JOIN Exams e ON s.ExamId = e.ExamId
JOIN Subjects sb ON s.SubjectId = sb.SubjectId
WHERE s.StudentId = 1
ORDER BY e.ExamDate, sb.SortOrder;
```

## 🎯 使用场景

### 场景1：家长会

展示学生各科成绩趋势，直观呈现进步情况。

### 场景2：学习分析

学生自我反思，发现优势科目和薄弱环节。

### 场景3：教师评估

教师了解班级整体成绩变化，调整教学策略。

### 场景4：升学规划

分析长期趋势，制定提升计划。

---

**现在可以轻松查看学生成绩进步情况了！** 🎉
